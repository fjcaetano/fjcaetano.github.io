


<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->

<head>


<meta charset="utf-8">
<meta http-equiv="cleartype" content="on">

<title>Protip: UIViewControllerAnimatedTransitioning + Snapshots - License to Kill -9</title>
<meta name="author" content="FlÃ¡vio Caetano">




<meta name="description" content="Mobile developer, kart aficionado, cinephile and musician in spare times. Not necessarily in that order.">

<meta name="keywords" content="Swift ">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Twitter Cards -->


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/assets/images/abstract-7.jpg" 
<meta name="twitter:title" content="Protip: UIViewControllerAnimatedTransitioning + snapshots">
<meta name="twitter:description" content="Mobile developer, kart aficionado, cinephile and musician in spare times. Not necessarily in that order.">
<meta name="twitter:creator" content="@flavio_caetano">


<!-- Open Graph -->
<meta property="og:local" content="en_US">
<meta property="og:type" content="article">
<meta property="og:url" content="http://blog.flaviocaetano.com/post/protip-uiviewcontrolleranimatedtransitioning-plus-snapshots">
<meta property="og:title" content="Protip: UIViewControllerAnimatedTransitioning + snapshots">
<meta property="og:description" content="Mobile developer, kart aficionado, cinephile and musician in spare times. Not necessarily in that order.">

<meta property="og:image" content="/assets/images/abstract-7.jpg">

<meta property="og:site_name" content="License to Kill -9">

<link rel="canonical" href="http://blog.flaviocaetano.com/post/protip-uiviewcontrolleranimatedtransitioning-plus-snapshots">
<link href="/favicon.png" rel="icon">
<link href="/assets/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
<link href="/atom.xml" rel="alternate" title="License to Kill -9" type="application/atom+xml">

<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
<script>Modernizr || document.write('<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"><\/script>')</script>



<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="https://secure.gravatar.com/avatar/3b339db885930633b86d73b97a2ca1c0?s=175" alt="FlÃ¡vio Caetano photo" class="author-photo">
					<h4>FlÃ¡vio Caetano</h4>
					<p>Mobile developer, kart aficionado, cinephile and musician in spare times. Not necessarily in that order.</p>
				</li>
				
				<li>
					<a href="mailto:blog@flaviocaetano.com"><i class="fa fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/flavio_caetano"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				
				<li>
					<a href="https://github.com/fjcaetano"><i class="fa fa-github"></i> GitHub</a>
				</li>
				<li>
					<a href="https://www.linkedin.com/in/flavio-vieira-caetano-8267851a/"><i class="fa fa-linkedin"></i> LinkedIn</a>
				</li>
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="/archives/">Archives</a></li>
				<li><a href="/categories/">All Categories</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  
  <div class="entry-image">
    <img src="/assets/images/abstract-7.jpg" alt="Protip: UIViewControllerAnimatedTransitioning + snapshots">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/post/protip-uiviewcontrolleranimatedtransitioning-plus-snapshots/" rel="bookmark" title="Protip: UIViewControllerAnimatedTransitioning + snapshots">Protip: UIViewControllerAnimatedTransitioning + Snapshots</a></h1>
        
        <h2>December 05, 2017</h2>
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">

      

      <p>When creating custom animations for view controller transitions, it is recommended
to use snapshots of the views being animated. However, UIKit doesnâ€™t always make
things crystal clear.</p>

<p>If you find yourself with broken autolayout or views incorrectly configured after
enabling your transition, try <strong>creating the snapshots after adding your view to
<code class="highlighter-rouge">containerView</code></strong>.</p>

<!-- more -->

<pre class="splash"><code><span class="keyword">func</span> animateTransition(using transitionContext: <span class="type">UIViewControllerContextTransitioning</span>) {
    <span class="keyword">guard let</span> fromVC = transitionContext.<span class="call">viewController</span>(forKey: .<span class="dotAccess">from</span>),
        <span class="keyword">let</span> toVC = transitionContext.<span class="call">viewController</span>(forKey: .<span class="dotAccess">to</span>),
        <span class="keyword">let</span> fromAnimatedView = fromVC.<span class="property">animatedView</span>.<span class="call">snapshotView</span>(afterScreenUpdates: <span class="keyword">true</span>),
        <span class="keyword">let</span> toAnimatedView = toVC.<span class="property">animatedView</span>.<span class="call">snapshotView</span>(afterScreenUpdates: <span class="keyword">true</span>) <span class="keyword">else</span> {
        <span class="keyword">return</span> transitionContext.<span class="call">completeTransition</span>(<span class="keyword">false</span>)
    }

    <span class="keyword">let</span> containerView = transitionContext.<span class="property">containerView</span>

    [fromAnimatedView, toAnimatedView].<span class="call">forEach</span>(containerView.<span class="call">addSubview</span>(<span class="keyword">_</span>:))

    <span class="comment">// Now you got yourself broken views. Hooray!</span>
    ...
}
</code></pre>

<p>The code above might not work. Your <code class="highlighter-rouge">toVC</code>â€™s view might end up completely broken
and your snapshots may have the wrong frame and contents. To fix it, simply move
the snapshots creation to after adding your destination view controllerâ€™s view to
<code class="highlighter-rouge">transitionContext.containerView</code>.</p>

<p>If you just try it after your <code class="highlighter-rouge">toVC</code> has ended initializing its views (i.e. after
<code class="highlighter-rouge">viewDidLoad</code> has been called) it wonâ€™t work, even if you force the view to be
loaded. You truly need to create your snapshots after the <code class="highlighter-rouge">containerView</code>.</p>

<pre class="splash"><code>   <span class="keyword">func</span> animateTransition(using transitionContext: <span class="type">UIViewControllerContextTransitioning</span>) {
      <span class="keyword">guard let</span> fromVC = transitionContext.<span class="call">viewController</span>(forKey: .<span class="dotAccess">from</span>),
          <span class="keyword">let</span> toVC = transitionContext.<span class="call">viewController</span>(forKey: .<span class="dotAccess">to</span>) <span class="keyword">else</span> {
              <span class="keyword">return</span> transitionContext.<span class="call">completeTransition</span>(<span class="keyword">false</span>)
      }

      <span class="keyword">let</span> containerView = transitionContext.<span class="property">containerView</span>
      containerView.<span class="call">addSubview</span>(toVC.<span class="property">view</span>)

      <span class="keyword">guard let</span> fromAnimatedView = fromVC.<span class="property">animatedView</span>.<span class="call">snapshotView</span>(afterScreenUpdates: <span class="keyword">true</span>),
          <span class="keyword">let</span> toAnimatedView = toVC.<span class="property">animatedView</span>.<span class="call">snapshotView</span>(afterScreenUpdates: <span class="keyword">true</span>) <span class="keyword">else</span> {
              <span class="keyword">return</span> transitionContext.<span class="call">completeTransition</span>(<span class="keyword">true</span>) <span class="comment">// toVC.view was already added to the container</span>
      }

      ...
  }
</code></pre>

<p>Boom! Done. Now it works ðŸŽ‰</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/categories/#Swift" title="Pages tagged Swift" class="tag">Swift</a></span>
        <span><a href="/post/protip-uiviewcontrolleranimatedtransitioning-plus-snapshots/" rel="bookmark" title="Protip: UIViewControllerAnimatedTransitioning + snapshots">Protip: UIViewControllerAnimatedTransitioning + snapshots</a> was published on <span class="entry-date date published updated"><time datetime="2017-12-05T15:06:12-05:00">December 05, 2017</time></span></span>
        
        <span class="author vcard"><span class="fn"><a href="https://flaviocaetano.com" title="About FlÃ¡vio Caetano">FlÃ¡vio Caetano</a></span></span>
        <div class="social-share">
          <ul class="socialcount socialcount-small inline-list">
            <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://blog.flaviocaetano.com/post/protip-uiviewcontrolleranimatedtransitioning-plus-snapshots" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
            <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://blog.flaviocaetano.com/post/protip-uiviewcontrolleranimatedtransitioning-plus-snapshots" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
            <li class="googleplus"><a href="https://plus.google.com/share?url=http://blog.flaviocaetano.com/post/protip-uiviewcontrolleranimatedtransitioning-plus-snapshots" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
          </ul>
        </div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
      <div class="read-more">
        
          <div class="read-more-header">
            <a href="/post/rendering-enums-in-swiftui/" class="btn">Read More</a>
          </div><!-- /.read-more-header -->
          <div class="read-more-content">
            <h3><a href="/post/rendering-enums-in-swiftui/" title="Rendering enums in SwiftUI">Rendering enums in SwiftUI</a></h3>
            <p>Enums are an excellent way to leverage Swift's value-types and immutability principles for handling states. Imagine you have a view that &hellip;&hellip; <a href="/post/rendering-enums-in-swiftui/"> Continue reading</a></p>
          </div><!-- /.read-more-content -->
        
        <div class="read-more-list">
          
            <div class="list-item">
              <h4><a href="/post/using-native-and-non-native-animations-together/" title="Using native and non-native animations together">Using native and non-native animations together</a></h4>
              <span>Published on November 11, 2019</span>
            </div><!-- /.list-item -->
          
            <div class="list-item">
              <h4><a href="/post/rogue-bit/" title="Rogue Bit ðŸ•¹">Rogue Bit ðŸ•¹</a></h4>
              <span>Published on October 31, 2019</span>
            </div><!-- /.list-item -->
          
        </div><!-- /.read-more-list -->
      </div><!-- /.read-more -->
    
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2021 FlÃ¡vio Caetano. Using the <a href="https://github.com/jez/hpstr-theme/">HPSTR Theme</a>.</span>

  </footer>
</div><!-- /.footer-wrapper -->



<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/octopress.js" type="text/javascript"></script>
<script src="/assets/js/scripts.min.js"></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36605430-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>




<script type="text/javascript">
      var disqus_shortname = 'flaviocaetanoblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.flaviocaetano.com/post/protip-uiviewcontrolleranimatedtransitioning-plus-snapshots/';
        var disqus_url = 'http://blog.flaviocaetano.com/post/protip-uiviewcontrolleranimatedtransitioning-plus-snapshots/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




</body>
</html>
