---
layout: post
title: This is when a CGFloat may be a double
date: 2014-06-30 11:00:29.000000000 -03:00
categories:
- Objective-C
tags:
- double
- float
- typecast
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _thumbnail_id: '521'
author:
  login: fjcaetano
  email: flavio@vieiracaetano.com
  display_name: Flávio Caetano
  first_name: Flávio
  last_name: Caetano
---
<p><!--:en-->
<p style="text-align: justify;">How would you explain the following code never getting into the <em>if</em> clause? Bear in mind I already knew it to be true at least once. I was an absolute true.</p>
<pre class="lang:objc decode:true">for (UIView *subview in view.subviews)
{
    CGFloat subviewAlpha = subview.alpha;
    CGFloat myAlpha = 0.15f;
    if (subviewAlpha == myAlpha &amp;&amp;
        [subview isKindOfClass:NSClassFromString(@"_UIPopoverViewBackgroundComponentView")])
    {
        subview.alpha = 0.f;
    }
 }</pre>
<p style="text-align: justify;">Printing the value also proved to be pointless:</p>
<pre class="lang:objc decode:true">NSLog(@"%f", subviewAlpha);
// output: 0.150000

NSLog(@"%f", myAlpha);
// output: 0.150000</pre>
<p style="text-align: justify;">Finally, XCode's debugger shed a dim of light to the real issue. It showed that the true value of <em>subviewAlpha</em> is 0.14999999999999999, and as a floating point it's accurate. Meanwhile the value of <em>myAlpha</em> was 0.15000000596046448, so logically they are different. But what could be causing this singularity?</p>
<p style="text-align: justify;">Jumping to <em>CGFloat</em> definition, we can see that it may be an alias to float or double, depending on the system's architecture (x32 or x64). As I neglected to search, <a href="https://developer.apple.com/library/prerelease/ios/documentation/GraphicsImaging/Reference/CGGeometry/index.html#//apple_ref/doc/constant_group/CGFloat_Informational_Macros" target="_blank">Apple had it documented</a> and it could have saved me some time (thanks <a href="https://twitter.com/gustavocsb/status/482602061352423424" target="_blank">@gustavocsb</a>, for the link).</p>
<p style="text-align: center;"><a href="{{ site.url }}/images/Screen-Shot-2014-06-28-at-12.53.35-AM.png"><img class="size-medium wp-image-781 aligncenter" alt="Screen Shot 2014-06-28 at 12.53.35 AM" src="{{ site.url }}/images/Screen-Shot-2014-06-28-at-12.53.35-AM-300x130.png" width="300" height="130" /></a></p>
<p style="text-align: justify;">As usual, I solved it the more elegant way I could. "Hey, if <em>CGFloat</em> is bipolar, let it tell me how to read it!"</p>
<pre class="lang:objc decode:true">for (UIView *subview in view.subviews)
{
    if (subview.alpha == (CGFloat)0.15 &amp;&amp;
        [subview isKindOfClass:NSClassFromString(@"_UIPopoverViewBackgroundComponentView")])
    {
        subview.alpha = 0.f;
    }
 }</pre>
<p style="text-align: justify;">Conclusion, always have in mind that typings and comparisons  may not be as obvious as they seem. Be careful and, when in doubt, <em>typecast</em> it.</p>
